<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–•–æ–∑—è–π—Å—Ç–≤–µ–Ω–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω</title>
</head>
<body>
  <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.username }} ({{ user.role }})</h1>
  <p>
    <a href="/logout">–í—ã—Ö–æ–¥</a>
    {% if user.role != 'admin' %}
      | <a href="/cart">üõí –ö–æ—Ä–∑–∏–Ω–∞</a>
      | <a href="/orders">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</a>
    {% endif %}
    {% if user.role == 'admin' %}
      | <a href="/admin/users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –∑–∞–∫–∞–∑—ã</a>
    {% endif %}
  </p>

  {% if user.role == 'admin' %}
    <h2>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h2>
    <form method="post" action="/add" enctype="multipart/form-data">
      <input type="text" name="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" required />
      <input type="number" step="0.01" name="price" placeholder="–¶–µ–Ω–∞" required />
      <input type="number" name="quantity" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" required />
      <input type="file" name="image" accept="image/*" />
      <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
    </form>
  {% endif %}

  <h2>–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤</h2>
  <table border="1" cellpadding="5" cellspacing="0">
    <thead>
      <tr>
        <th>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</th>
        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
        <th>–¶–µ–Ω–∞</th>
        <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
      </tr>
    </thead>
    <tbody>
      {% for product in products %}
      <tr>
        <td>
          {{ product.name }}<br />
          {% if product.image_path %}
            <img src="/static/{{ product.image_path }}" width="100" />
          {% endif %}
        </td>
        <td>{{ product.name }}</td>
        <td>{{ product.price }} USD</td>
        <td>
          {% if product.quantity > 0 %}
            {{ product.quantity }}
          {% else %}
            <strong>–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</strong>
          {% endif %}
        </td>
        <td>
          {% if user.role == 'admin' %}
            <a href="/admin/edit/{{ product.id }}">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a><br />
            <form method="post" action="/delete/{{ product.id }}" style="display:inline;">
              <button type="submit" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?')">–£–¥–∞–ª–∏—Ç—å</button>
            </form>
          {% else %}
            {% if product.quantity > 0 %}
              <form method="post" action="/cart/add/{{ product.id }}">
                <input type="number" name="quantity" min="1" max="{{ product.quantity }}" value="1" required />
                <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
              </form>
            {% else %}
              –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏
            {% endif %}
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</body>
</html>
